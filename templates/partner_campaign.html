{% extends 'base.html' %}

{% block title %}{{ gettext("Get Origin Protocol") }}{% endblock %}

{% block meta_description %}{{ gettext("Get Origin Protocol") }}{% endblock %}

{% block extra_styles %}
<link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet" />
<style type="text/css">
  body {
    background: #007fff;
    color: #fff;
  }
  .partner-campaign-page {}
  .partner-campaign-page hr {
    background: #fff;
    height: 1px;
    width: 84%;
    border: 0;
  }
  .partner-campaign-page .desktop {}
  #app-download-button {
    background: none;
    /* TODO: tbd */
    height: 90px;
    width: 280px;
    padding: 0;
    border: 0;
  }
  #partner-campaign-header {
    background: #fff;
    display: block;
    width: 100%;
    height: 90px;
  }
  #partner-campaign-header .logo {
    display: block;
    float: left;
    text-align: center;
    width: 50%;
    height: 90px;
    margin: 10px 0;
    padding: 15px;
  }
  #partner-campaign-header .logo img {
    height: 22px;
    width: auto;
    margin: 10px auto;
  }
  #partner-campaign-header .partner.logo {}
  #partner-campaign-header .origin.logo {}
  #tagline {
    margin: 50px 25px 25px;
  }
  #tagline p {

    font-size: 20px;
    font-weight: 500;
    line-height: 35px;
    text-align: center;
  }
  #intro {}
  #intro p {
    font-family: Lato, sans-serif;
    font-size: 20px;
    line-height: 1.3;
    margin: 30px;
  }
  #callout {}
  #callout p {
    font-family: "Poppins", sans-serif;
    text-align: center;
    font-size: 27px;
    font-weight: 1000;
    text-transform: uppercase;
  }
  #callout .value {
    display: block;
    font-size: 72px;
  }
  #download {
    text-align: center;
  }
  #app-download-button {
    text-indent: -9999px;
    margin: 0 auto;
  }
  #rewards {
    font-family: Lato, sans-serif;
    font-size: 18px;
    line-height: 1.44;
    margin: 30px;
  }
  #rewards h2 {
    font-family: Lato, sans-serif;
    font-size: 18px;
    font-weight: bold;
  }
  #screenshot1 {
    text-align: center;
  }
  #screenshot1 img,
  #screenshot2 img,
  #screenshot2-desktop img {
    /* these have some drop shadow on the right */
    position: relative;
    left: 15px;
  }
  #screenshot1 hr {
    width: 100%;
    margin: 0;
  }
  #screenshot2 {
    text-align: center;
  }
  #screenshot2 img {}
  #screenshot2 hr {
    width: 100%;
    margin: 0;
  }
  #legal {
    margin: 54px 8%;
  }
  #legal p {
    font-family: Lato, sans-serif;
    font-size: 12px
  }
  #testing {}

  .hidden-desktop {}
  .hidden-mobile {
    display: none;
  }
  .desktop-split {}
  .float-desktop {}

  @media only screen and (min-width: 600px) {
    #screenshot1 hr,
    #screenshot2 hr {
      display: none;
    }
    #tagline p { font-size: 25px; }
    #callout { font-size: 32px }
    #callout .value { font-size: 88px }
    #intro p { font-size: 18px; }
    #partner-campaign-header .partner.logo { text-align: left; }
    #partner-campaign-header .origin.logo { text-align: right; }

    #screenshot1 img,
    #screenshot2 img,
    #screenshot2-desktop img { left: 75px; }

    .qrcode-wrapper p {
      font-family: Lato, sans-serif;
      font-size: 14px;
      line-height: 26px;
      text-align: center;
    }
    .qrcode-wrapper img {
      margin: 0 auto;
      margin-top: 10px;
    }
    .qrcode-wrapper {
      background: #fff;
      color: #000;
      padding: 5px;
      margin: 0 auto;
      width: 190px;
      height: 190px;
      border-radius: 20px;
    }
    .hidden-mobile {
      display: inherit;
    }
    .hidden-desktop {
      display: none;
    }
    .desktop-split {
      display: block;
      max-width: 1024px;
      margin: 0 auto;
    }
    .float-desktop {
      float: left;
      width: 50%;
      margin: 0;
    }
    .page-splitter {
      width: 100%;
      margin: 50px auto;
    }
  }
</style>
{% endblock %}

{% block extra_scripts %}
  <script src="/static/js/qrcode.min.js" type="text/javascript"></script>
  <script>
    const isIOS = navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform)
    const referalCode = 'op:{{ referral_code }}'
    const me = `${location.origin}/partner/{{ referral_code }}`

    const qrOptions = {
      text: me,
      width: 140,
      height: 140,
      colorDark : "#000000",
      colorLight : "#ffffff",
      correctLevel : QRCode.CorrectLevel.H
    }
    const qrcode1 = new QRCode('qrcode1', qrOptions)
    const qrcode2 = new QRCode('qrcode2', qrOptions)

    /**
     * Copy a string to the clipboard
     */
    function codeToClipboard(code) {
      code = code || referalCode

      // Use navigator.clipboard if available (cleaner)
      if (navigator.clipboard) {
        return navigator.clipboard.writeText(code)
      }

      // The hard way because it's a crap browser
      return new Promise((resolve, reject) => {
        // Create element
        const tmp = document.createElement('span')
        tmp.style.display = 'none'
        tmp.textContent = code
        document.body.appendChild(tmp)

        // Selection
        const sel = document.getSelection()
        sel.removeAllRanges()

        // Range
        const rng = document.createRange()
        rng.selectNodeContents(tmp)

        // Add the range to the selection
        sel.addRange(rng)
        console.debug('selected: ', sel.getRangeAt(0).cloneContents())

        // Copy the text in the range
        const res = document.execCommand('copy')
        document.body.removeChild(tmp)
        if (!res) {
          reject('Failed to execute copy of text')
        }
        resolve()
      })
    }

    /**
     * handle download button click and go to the appropriate download page
     */
    function downloadApp() {
      let url = '{{ play_store_url }}'
      if (isIOS) {
        url = '{{ app_store_url }}'
      }
      codeToClipboard(referalCode).then(() => {
        const win = window.open(url)
        // If we got snagged by a popup blocker(firefox) just go direct
        if (!win) {
          window.location = url
        }
      }).catch((err) => {
        console.error('Problem copying code to clipboard')
        console.error(err)
        window.location = url
      })
    }

    /**
     * Figure out which button to display
     */
    function detectButton() {
      const button = document.getElementById('app-download-button')
      if (!button) {
        console.warn('Did not find #app-download-button')
        return
      }
      if (isIOS) {
        console.log('ios')
        button.style.backgroundImage = 'url(/static/img/app-store.svg)'
      } else {
        console.log('not-ios')
        button.style.backgroundImage = 'url(/static/img/play-store.svg)'
      }
      button.style.backgroundRepeat = 'no-repeat'
      button.style.height = '100px'
      button.style.width = '280px'
      console.log('setting backgroundImage to: ', button.style.backgroundImage)

      button.addEventListener('click', e => {
        console.log('!!!!!')
        codeToClipboard()
      })
      const testButton = document.getElementById('test-button')
      testButton.addEventListener('click', e => {
        console.log('!!!!!')
        codeToClipboard().catch(err => console.error(err))
      })
    }

    window.addEventListener('DOMContentLoaded', () => {
      detectButton()
      const values = document.getElementsByClassName('value')
      for (const el of values) {
        el.innerHTML = Number(el.innerHTML).toLocaleString()
      }
    })
  </script>
{% endblock %}

{% block content %}

<main class="partner-campaign-page">
  <div id="partner-campaign-header">
    <div class="origin logo"><a href="/"><img src="/static/img/origin-logo-dark@3x.png" alt="Origin" /></a></div>
    <div class="partner logo"><img src="{{ partner.logo }}" alt="{{ partner.name }}" /></div>
  </div>
  <div class="desktop-split clearfix">
    <div class="float-desktop">
      <section id="tagline">
        <p>{{ gettext("Get Origin Marketplace & earn") }}</p>
      </section>
      <hr />
      <section id="callout">
        <p><span class="value">{{ reward.value }}</span> {{ gettext("Origin Tokens") }}</p>
      </section>
      <hr />
      <section id="intro">
        <p>{{ gettext("Get started by downloading Origin Marketplace - the app that allows you to buy and sell anything using crypto right from your phone.") }}</p>
      </section>
      <section id="download" class="hidden-desktop">
        <button id="app-download-button" onclick="downloadApp()"></button>
      </section>
      <section class="qrcode-wrapper hidden-mobile">
        <div id="qrcode1"></div>
        <p>Scan to install our app</p>
      </section>
    </div>
    <div class="float-desktop">
      <section id="download">
        <button id="app-download-button" onclick="downloadApp()"></button>
      </section>
      <section id="screenshot1">
        <img class="hidden-desktop" src="/static/img/partner/iphone-1.png" />
        <img class="hidden-mobile" src="/static/img/partner/iphone-1-full.png" />
        <hr />
      </section>
    </div>
  </div>
  <hr class="hidden-mobile page-splitter" />
  <div class="desktop-split clearfix">
    <div class="float-desktop">
      <section id="screenshot2-desktop" class="hidden-mobile">
        <img src="/static/img/partner/iphone-2-full.png" />
        <hr class="hidden-desktop" />
      </section>
    </div>
    <div class="float-desktop">
      <section id="rewards">
        <h2>{{ gettext("What are Origin Rewards?") }}</h2>
        <p>{{ gettext("Rent a home, buy concert tickets, or hire a contractor on Origin, the worldâ€™s first marketplace and crypto wallet all-in-one app.") }}</p>
      </section>
      <section id="screenshot2" class="hidden-desktop">
        <img src="/static/img/partner/iphone-2.png" />
        <hr />
      </section>
      <section id="legal">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ultrices, neque eu euismod tristique, metus turpis suscipit magna, ut porta ligula elit et dolor. Proin in lorem quis urna commodo commodo quis eu diam. Maecenas ullamcorper vestibulum faucibus. Cras turpis dolor, laoreet in tristique at, eleifend et purus. Quisque at felis dolor. Nunc varius pharetra velit eget faucibus. Donec viverra purus imperdiet, efficitur mauris aliquam, rhoncus sapien. Phasellus vitae egestas ligula. Vestibulum venenatis interdum odio, sed vulputate orci ornare vitae. Sed lacinia, sapien sed auctor fringilla, quam nunc aliquam felis, ut sollicitudin metus quam et dui.</p>

        <p>Donec facilisis lacus ac ligula ultrices, in volutpat orci condimentum. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Mauris eleifend purus enim, non imperdiet ipsum lacinia non. Aliquam scelerisque molestie euismod. Vivamus pretium accumsan ipsum in sodales. Praesent venenatis ex id lectus commodo, in vehicula libero eleifend. In hac habitasse platea dictumst. Fusce eget dapibus lectus. Morbi convallis sit amet turpis at facilisis. Nulla id magna in ex dignissim fermentum ac eu lacus.</p>
      </section>
      <section class="qrcode-wrapper hidden-mobile">
        <div id="qrcode2"></div>
        <p>{{ gettext("Scan to install our app") }}</p>
      </section>
    </div>
  </div>
</main>

{% endblock %}